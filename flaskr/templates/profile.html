{% extends 'base.html' %}

{% block title %} Profile {% endblock %}

{% block additional %}
<a style = "float:right" href="#trend">트랜드 보기</a>
<a id="top" style = "float:right" href="#self">셀프 결과 보기</a>
<a style = "float:right" href="#peerSelf">타깃 결과 보기</a>
{% endblock %}



{% block content %}
    <hr><h1 id="peerSelf">나에게 온 타깃 테스트 결과</h1><hr>
    {% for stest in peerassessments %}
        {% if g.user['username'] == stest['target_username'] %}
            <article class="testResults">
                {% if stest['new_tagp'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/peer/" + stest['route']}}> {{stest['username']}} 가 나를 위하여 {{ stest['created'].strftime('%Y-%m-%d %H:%M:%S') }} UTC 에 본 테스트</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}
    <a href="#top">Back to the Top</a>
    <hr>

    <hr><h1 id="selfPeer">내가 본 타깃 테스트 결과</h1><hr>
    {% for stest in peerassessments %}
        {% if g.user['username'] == stest['username'] %}
            <article class="testResults">
                {% if stest['new_tags'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/peer/" + stest['route']}}> {{stest['target_username']}} 를 위하여 {{ stest['created'].strftime('%Y-%m-%d %H:%M:%S') }} UTC 에 본 테스트</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}
    <a href="#top">Back to the Top</a>
    <hr>

    <h1 id="self">셀프 테스트 결과</h1><hr>
    {% for stest in selfassessments %}
        {% if g.user['id'] == stest['author_id'] %}
            <article class="testResults">
                {% if stest['new_tag'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/self/" + stest['route']}}> {{ stest['created'].strftime('%Y-%m-%d %H:%M:%S') }} UTC 에 본 셀프 테스트</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}

    <a href="#top">Back to the Top</a>
    <hr>

    <h1 id="trend">트랜드 그래프</h1><hr>

    <div id="EItrend" style="width:600px;height:250px;" class="trendgraph">

        <script>
            var EIVals = []
            var testDate = []
            var layout = {
                title: 'EI Graph (+: E, -: I)',
                showlegend: false
            };
        </script>
        {% for stest in selfassessments|reverse %}
            {% if g.user['id'] == stest['author_id'] %}
                <script>testDate.push("{{stest['created'].strftime('%Y-%m-%d %H:%M:%S')}}"); EIVals.push({{stest['guess_MBTI_EI']}}); </script>
            {% endif %}
        {% endfor %}
        <script>
            EITREND = document.getElementById('EItrend');
            var traceEI = {
                x: testDate,
                y: EIVals,
                type: 'scatter'
            };
            var data = [traceEI];
            Plotly.newPlot(EITREND, data, layout, {displaylogo: false, displayModeBar: false});
        </script>
    </div>
    <div id="SNtrend" style="width:600px;height:250px;" class="trendgraph">

        <script>
            var SNVals = []
            var testDate = []
            var layout = {
                title: 'SN Graph (+: S, -: N)',
                showlegend: false
            };
        </script>
        {% for stest in selfassessments|reverse %}
            {% if g.user['id'] == stest['author_id'] %}
                <script>testDate.push("{{stest['created'].strftime('%Y-%m-%d %H:%M:%S')}}"); SNVals.push({{stest['guess_MBTI_SN']}}); </script>
            {% endif %}
        {% endfor %}
        <script>
            SNTREND = document.getElementById('SNtrend');
            var traceSN = {
                x: testDate,
                y: SNVals,
                type: 'scatter'
            };
            var data = [traceSN];
            Plotly.newPlot(SNTREND, data, layout, {displaylogo: false, displayModeBar: false});
        </script>
    </div>
    <div id="TFtrend" style="width:600px;height:250px;" class="trendgraph">
        <script>
            var TFVals = []
            var testDate = []
            var layout = {
                title: 'TF Graph (+: T, -: F)',
                showlegend: false
            };
        </script>
        {% for stest in selfassessments|reverse %}
            {% if g.user['id'] == stest['author_id'] %}
                <script>testDate.push("{{stest['created'].strftime('%Y-%m-%d %H:%M:%S')}}"); TFVals.push({{stest['guess_MBTI_TF']}}); </script>
            {% endif %}
        {% endfor %}
        <script>
            TFTREND = document.getElementById('TFtrend');
            var traceTF = {
                x: testDate,
                y: TFVals,
                type: 'scatter'
            };
            var data = [traceTF];
            Plotly.newPlot(TFTREND, data, layout, {displaylogo: false, displayModeBar: false} );
        </script>
    </div>
    <div id="JPtrend" style="width:600px;height:250px;" class="trendgraph">
        <script>
            var JPVals = []
            var testDate = []
            var layout = {
                title: 'JP Graph (+: J, -: P)',
                showlegend: false
            };
        </script>
        {% for stest in selfassessments|reverse %}
            {% if g.user['id'] == stest['author_id'] %}
                <script>testDate.push("{{stest['created'].strftime('%Y-%m-%d %H:%M:%S')}}"); JPVals.push({{stest['guess_MBTI_JP']}}); </script>
            {% endif %}
        {% endfor %}
        <script>
            JPTREND = document.getElementById('JPtrend');
            var traceJP = {
                x: testDate,
                y: JPVals,
                type: 'scatter'
            };
            var data = [traceJP];
            Plotly.newPlot(JPTREND, data, layout, {displaylogo: false, displayModeBar: false});
        </script>
    </div>

    <a href="#top">Back to the Top</a>
    <br><br><br>



{% endblock %}