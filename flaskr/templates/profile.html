{% extends 'base.html' %}

{% block title %} Profile {% endblock %}

{% block additional %}
<a id="top" style = "float:right" href="#self">Self Results</a>
<a style = "float:right" href="#peerSelf">Peer Results</a>
{% endblock %}



{% block content %}
    <hr><h1 id="peerSelf">Peer Results for You</h1><hr>
    {% for stest in peerassessments %}
        {% if g.user['username'] == stest['target_username'] %}
            <article class="testResults">
                {% if stest['new_tagp'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/peer/" + stest['route']}}> Peer Assessment by {{stest['username']}} on {{ stest['created'].strftime('%Y-%m-%d') }}</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}
    <a href="#top">Back to the Top</a>
    <hr>

    <hr><h1 id="selfPeer">Peer Results by You</h1><hr>
    {% for stest in peerassessments %}
        {% if g.user['username'] == stest['username'] %}
            <article class="testResults">
                {% if stest['new_tags'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/peer/" + stest['route']}}> Peer Assessment for {{stest['target_username']}} on {{ stest['created'].strftime('%Y-%m-%d') }}</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}
    <a href="#top">Back to the Top</a>
    <hr>

    <h1 id="self">Self Results</h1><hr>
    {% for stest in selfassessments %}
        {% if g.user['id'] == stest['author_id'] %}
            <article class="testResults">
                {% if stest['new_tag'] == 1 %} <h1>NEW!</h1> {% endif %}
                <a href= {{"/results/self/" + stest['route']}}> Self Assessment on {{ stest['created'].strftime('%Y-%m-%d') }}</a>
            </article>
            <hr>
        {% endif %}
    {% endfor %}

    <a href="#top">Back to the Top</a>
    <hr>

    <h1 id="trend">Trend Graph</h1><hr>
    <h1>Self Result Trend</h1>
    <div id="tester" style="width:600px;height:250px;" class="trendgraph">

        <script>
            var testResults = []
            var testCounter = []
            var testAvg = 0
            var counter = 0
        </script>
        {% for stest in selfassessments|reverse %}
            {% if g.user['id'] == stest['author_id'] %}
                <script>counter = counter + 1; testCounter.push(counter)</script>
                {% for i in range (1,21) %}
                    <script>testAvg = testAvg + {{stest['q' + i|string]}}</script>
                {% endfor %}
                <script>testResults.push(testAvg / 20 - 1.5); testAvg = 0</script>
            {% endif %}
        {% endfor %}
        <script>
            TESTER = document.getElementById('tester');
            Plotly.newPlot( TESTER, [{
            x: testCounter,
            y: testResults }], {
            margin: { t: 0 } } );
        </script>
    </div>
    <br><br><br>



{% endblock %}